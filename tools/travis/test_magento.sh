#!/usr/bin/env bash
# Magento Malware Scanner
#
# Runs all YARA rules against the installed set of vanilla code

if [ ! -z ${MAGENTO_VERSION+x} ]; then

    target_directory="${SETUP_DIR:-./}${MAGENTO_VERSION}"

    echo "Testing YARA rules against vanilla magento version ${MAGENTO_VERSION}"

    if [ -d "$target_directory" ]; then # the prepare_magento.sh file should skip this when the download failed

        TEST=`yara -r ./rules/all-confirmed.yar ${target_directory}`

        if [[ $TEST ]]; then
            exit 1
        else
            exit 0
        fi
    fi
fi
