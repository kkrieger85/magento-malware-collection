# Contributing

Found a new malware? Great! Add a new sample and rule in 5 minutes.

1. Add malware file
1. Find a literal string or regex that identifies the malware
1. Run tests to validate results
1. Make Pull Request
1. Profit!

Every malware should have at least 1 corresponding rule.

Every rule should have at least 1 corresponding malware. 

# Procedure

```bash
# Install prerequisites on Debian/Ubuntu flavoured server
sudo apt install yara python3 -y

# Install prerequisites on a Mac OSX environemnt
brew install yara python3

# Fork this repo first, then checkout
git clone https://github.com/<yourusername>/magento-malware-scanner.git
cd magento-malware-scanner

# Run scan to test
yara -r rules/all-confirmed.yar malware

# Copy your malware file to malware/incoming, then run
tools/md5_to_incoming.sh

# Run tests (in separate window) to validate signatures and samples
watch python tools/runtests.py

# Add signature to rules/backend.yar and see the tests go OK

# (Optionally) verify that no false positives will be raised
./tools/mageffcheck.sh init && ./tools/mageffcheck.sh run

# Commit, push & go to github.com to create Pull Request
```


# Signature strategies

Malware signatures can be extremely specific (a file checksum) to generic (check for suspicious `eval()`) or anything in between. As a signature author, you have to decide on a proper balance. Pro specific: no chance for false positives. Pro generic: less work, as one signature will catch multiple strains of malware.

> In case of doubt, choose specific. 

Taking a shortcut with a more generic signature might be tempting, but if it causes false positives (possibly in the future), you will have to deal with the fallout, _plus_ have to repeat your malware analysis.  

Remember, we can already win a lot by de-duplicating unique malware instance identification across organisations. Identifying future, or merely suspicious, malware is also desireable but requires a different strategy.

Other malware research suggests that malwares are quickly morphing, rendering the average lifespan of a unique malware instance to be [only 58 seconds](https://twitter.com/jeremiahg/status/799734794737184768). But I haven't seen this behaviour in Magento specific malware yet. Let's enjoy the tide while it lasts.